{% extends 'base.html' %}

{% block title %} LMForge: Add Documents to Your Dataset {% endblock %}

{% block content %}
{% load static %}
<div class="container mt-4">
    <h1>Dataset Workflow</h1>
    <div>
        <p>Add new documents (ex. PDFs, websites, plain text, etc.) to include in your dataset. Once all of the desired documents are uploaded, select those you wish to include in the dataset and move to the next step.</p>
    </div>
 
    {% if messages %}
    <div class="alert alert-info">
        <ul class="mb-0">
            {% for message in messages %}
            <li>{{ message }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}   

    <h2>Processed Documents</h2>
    <a href="{% url 'document-processor' %}" class="button success">+ New Document</a>
    <form method="POST" action="{% url 'document_detail' %}">
        {% csrf_token %}

        {% include "document_list.html" %}
        
        <button type="submit" class="btn btn-success mt-3" style="margin-bottom: 1vh;">Proceed with Selected</button>
    </form>

    <nav aria-label="Page navigation">
        <ul class="pagination">
            {% if documents.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page=1">First</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ documents.previous_page_number }}">Previous</a>
            </li>
            {% endif %}

            <li class="page-item disabled">
                <span class="page-link">Page {{ documents.number }} of {{ documents.paginator.num_pages }}</span>
            </li>

            {% if documents.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ documents.next_page_number }}">Next</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ documents.paginator.num_pages }}">Last</a>
            </li>
            {% endif %}
        </ul>
    </nav>


</div>


<!-- Hidden delete form outside the main form -->
<form id="deleteForm" method="POST" style="display: none;">
    {% csrf_token %}
    <input type="hidden" name="redirect" value="dataset-workflow">
</form>

<!-- JavaScript for handling delete action -->
<script>
    function deleteDocument(documentId) {
        if (confirm("Are you sure you want to delete this document?")) {
            var form = document.getElementById("deleteForm");
            form.action = "{% url 'delete_document' 0 'redirect_url' %}".replace("0", documentId).replace("redirect_url", encodeURIComponent('dataset-workflow'));
            form.submit();
        }
    }
</script>

{% endblock %}